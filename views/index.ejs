<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BlackBass — Marketplace de Instrumentos Musicais</title>
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <%- include('partials/navbar.ejs') %>

  <main class="index-main">
    <!-- ========= PRODUTOS MAIS ACESSADOS ========= -->
    <div class="mais-acessados-header">
      <h2>Itens mais acessados</h2>
    </div>
    
    <section class="mais-vistos">
      <div class="most-viewed-gallery-wrap">
        <div class="most-viewed-gallery">
          <% (maisVistos || []).forEach(item => { 
               const imagens = (item.imagem_url || '').split(',').filter(Boolean);
               const imagemPrincipal = imagens.length > 0 ? imagens[0] : '/images/item.png';
          %>
            <div class="card-produto-uniforme">
              <a href="/item/<%= item.id %>">
                <div class="imagem-container">
                  <img src="<%= imagemPrincipal %>" alt="<%= item.nome %>" onerror="this.onerror=null;this.src='/images/item.png';">
                  <div class="card-overlay">
                    <span class="card-badge">Ver detalhes</span>
                  </div>
                </div>
                <div class="info-produto">
                  <h3><%= item.nome %></h3>
                  <p class="produto-preco">
                    <strong><%= Number(item.preco).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) %></strong>
                  </p>
                  <div class="produto-meta">
                    <% if (item.shape) { %>
                      <span class="meta-tag"><%= item.shape %></span>
                    <% } %>
                    <% if (item.marca) { %>
                      <span class="meta-tag"><%= item.marca %></span>
                    <% } %>
                  </div>
                  <div class="produto-stats">
                    <span class="stats-item">
                      <i class="fa-solid fa-eye"></i>
                      <%= item.acessos || 0 %> acessos
                    </span>
                  </div>
                </div>
              </a>
            </div>
          <% }) %>
        </div>
      </div>
    </section>

    <!-- ========= MARCAS EM DESTAQUE ========= -->
    <div class="brands-gallery-title">
      <h2>Marcas</h2>
    </div>
    
    <div class="brands-filter-gallery-wrap">
  <div class="brands-carousel-row">
    <img src="/images/back.png" id="backBtn">
    <div class="brands-filter-gallery">
      <div>
        <a href="/produtos?marca=Fender"><img src="/images/brand_logos/brand_fender.png" alt="Fender"></a>
        <a href="/produtos?marca=Tagima"><img src="/images/brand_logos/brand_tagima.png" alt="Tagima"></a>
        <a href="/produtos?marca=Yamaha"><img src="/images/brand_logos/brand_yamaha.png" alt="Yamaha"></a>
        <a href="/produtos?marca=Ibanez"><img src="/images/brand_logos/brand_ibanez.png" alt="Ibanez"></a>
        <a href="/produtos?marca=Gibson"><img src="/images/brand_logos/brand_gibson.png" alt="Gibson"></a>
        <a href="/produtos?marca=Godin"><img src="/images/brand_logos/brand_godin.png" alt="Godin"></a>
        <a href="/produtos?marca=Guild"><img src="/images/brand_logos/brand_guild.png" alt="Guild"></a>
        <a href="/produtos?marca=Luna"><img src="/images/brand_logos/brand_luna.png" alt="Luna"></a>
        <a href="/produtos?marca=Gretsch"><img src="/images/brand_logos/brand_gretsch.png" alt="Gretsch"></a>
        <a href="/produtos?marca=Jackson"><img src="/images/brand_logos/brand_jackson.png" alt="Jackson"></a>
      </div>
    </div>
    <img src="/images/forward.png" id="forwardBtn">
  </div>
</div>

    <!-- ========= LOJAS EM DESTAQUE ========= -->
    <div class="stores-title">
      <h2>Lojas em Destaque</h2>
    </div>

    <div class="stores-carousel-wrap">
  <div class="stores-carousel-row">
    <img src="/images/back.png" id="storesBackBtn" alt="Voltar">

<div class="stores-carousel">
  <div class="stores-track">
    <% (lojasTop || []).forEach(loja => { %>
      <div class="store-card">
        <a href="/loja/<%= loja.id %>" title="<%= loja.nomeFantasia %>">
          <img 
            src="https://ckfaesrraivatujsqpxc.supabase.co/storage/v1/object/sign/newLogo/LOGO2png.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV84NmExZjBlMC05Yjg5LTQwNjMtYTk5ZS03ZDE0MGViOWZjYjIiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJuZXdMb2dvL0xPR08ycG5nLnBuZyIsImlhdCI6MTc2NjE3MDU3NiwiZXhwIjoxNzk3NzA2NTc2fQ.HB_LfV2U8WHuMxeVqcMaxdmk4gT3W9F-3KkRPFEyIVY" 
            alt="<%= loja.nomeFantasia %>" 
            class="banner-logo"
          >
        </a>

        <div class="store-card-info">
          <h4 class="store-nome"><%= loja.nomeFantasia %></h4>
          <div class="store-rating">
            <% 
              const nota = Number(loja.nota_media) || 0;
              const estrelasCheias = Math.floor(nota);
              const meiaEstrela = (nota % 1) >= 0.5;
              const estrelasVazias = 5 - estrelasCheias - (meiaEstrela ? 1 : 0);
            %>

            <% for (let i = 0; i < estrelasCheias; i++) { %>
              <i class="fa-solid fa-star"></i>
            <% } %>

            <% if (meiaEstrela) { %>
              <i class="fa-solid fa-star-half-stroke"></i>
            <% } %>

            <% for (let i = 0; i < estrelasVazias; i++) { %>
              <i class="fa-regular fa-star"></i>
            <% } %>

            <span class="nota-text">(<%= nota.toFixed(1) %>)</span>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

    <img src="/images/forward.png" id="storesForwardBtn" alt="Avançar">
  </div>
</div>

<%- include('partials/footer.ejs') %>
</main>

  <script>
    const backBtn = document.getElementById("backBtn");
    const forwardBtn = document.getElementById("forwardBtn");
    const carousel = document.querySelector(".brands-filter-gallery");
  
    const scrollAmount = 400; // Adjust based on how much you want to scroll
  
    backBtn.addEventListener("click", () => {
      carousel.scrollBy({
        left: -scrollAmount,
        behavior: "smooth"
      });
    });
  
    forwardBtn.addEventListener("click", () => {
      carousel.scrollBy({
        left: scrollAmount,
        behavior: "smooth"
      });
    });
  </script>

<script>
  const storesbackBtn = document.getElementById("storesBackBtn");
  const storesforwardBtn = document.getElementById("storesForwardBtn");
  const storescarousel = document.querySelector(".stores-carousel");

  const storesScrollAmount = 400; // Adjust based on how much you want to scroll

  storesbackBtn.addEventListener("click", () => {
    storescarousel.scrollBy({
      left: -storesScrollAmount,
      behavior: "smooth"
    });
  });

  storesforwardBtn.addEventListener("click", () => {
    storescarousel.scrollBy({
      left: storesScrollAmount,
      behavior: "smooth"
    });
  });
</script>





</body>
</html>